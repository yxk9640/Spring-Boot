{
  "version": 3,
  "sources": ["src/EndpointProcessor.ts"],
  "sourcesContent": ["import type Plugin from '@hilla/generator-typescript-core/Plugin.js';\nimport ClientPlugin from '@hilla/generator-typescript-plugin-client';\nimport createSourceFile from '@hilla/generator-typescript-utils/createSourceFile.js';\nimport DependencyManager from '@hilla/generator-typescript-utils/dependencies/DependencyManager.js';\nimport PathManager from '@hilla/generator-typescript-utils/dependencies/PathManager.js';\nimport { OpenAPIV3 } from 'openapi-types';\nimport type { ReadonlyDeep } from 'type-fest';\nimport type { SourceFile, Statement } from 'typescript';\nimport EndpointMethodOperationProcessor, {\n  HILLA_FRONTEND_NAME,\n  INIT_TYPE_NAME,\n} from './EndpointMethodOperationProcessor.js';\n\nexport default class EndpointProcessor {\n  static async create(\n    name: string,\n    owner: Plugin,\n    methods: Map<string, ReadonlyDeep<OpenAPIV3.PathItemObject>>,\n    outputDir?: string,\n  ): Promise<EndpointProcessor> {\n    const endpoint = new EndpointProcessor(name, owner, methods, outputDir);\n    endpoint.#dependencies.imports.default.add(\n      endpoint.#dependencies.paths.createRelativePath(await ClientPlugin.getClientFileName(outputDir)),\n      'client',\n    );\n    endpoint.#dependencies.imports.named.add(\n      endpoint.#dependencies.paths.createBareModulePath(HILLA_FRONTEND_NAME),\n      INIT_TYPE_NAME,\n    );\n    return endpoint;\n  }\n\n  readonly #createdFilePaths = new PathManager({ extension: 'ts' });\n  readonly #dependencies = new DependencyManager(new PathManager({ extension: '.js' }));\n  readonly #methods: Map<string, ReadonlyDeep<OpenAPIV3.PathItemObject>>;\n  readonly #name: string;\n  readonly #outputDir: string | undefined;\n  readonly #owner: Plugin;\n\n  private constructor(\n    name: string,\n    owner: Plugin,\n    methods: Map<string, ReadonlyDeep<OpenAPIV3.PathItemObject>>,\n    outputDir?: string,\n  ) {\n    this.#name = name;\n    this.#owner = owner;\n    this.#methods = methods;\n    this.#outputDir = outputDir;\n  }\n\n  async process(): Promise<SourceFile> {\n    this.#owner.logger.debug(`Processing endpoint: ${this.#name}`);\n\n    const statements = (\n      await Promise.all(Array.from(this.#methods, async ([method, pathItem]) => this.#processMethod(method, pathItem)))\n    ).flatMap((item) => item);\n\n    const { exports, imports } = this.#dependencies;\n\n    return createSourceFile(\n      [...imports.toCode(), ...statements, ...exports.toCode()],\n      this.#createdFilePaths.createRelativePath(this.#name),\n    );\n  }\n\n  async #processMethod(\n    method: string,\n    pathItem: ReadonlyDeep<OpenAPIV3.PathItemObject>,\n  ): Promise<readonly Statement[]> {\n    this.#owner.logger.debug(`Processing endpoint method: ${this.#name}.${method}`);\n\n    return (\n      await Promise.all(\n        Object.values(OpenAPIV3.HttpMethods)\n          .filter((httpMethod) => pathItem[httpMethod])\n          .map(\n            async (httpMethod) =>\n              EndpointMethodOperationProcessor.createProcessor(\n                httpMethod,\n                this.#name,\n                method,\n                pathItem[httpMethod]!,\n                this.#dependencies,\n                this.#owner,\n              )?.process(this.#outputDir),\n          ),\n      )\n    ).filter(Boolean) as readonly Statement[];\n  }\n}\n"],
  "mappings": "AACA,OAAO,kBAAkB;AACzB,OAAO,sBAAsB;AAC7B,OAAO,uBAAuB;AAC9B,OAAO,iBAAiB;AACxB,SAAS,iBAAiB;AAG1B,OAAO;AAAA,EACL;AAAA,EACA;AAAA,OACK;AAEP,MAAO,kBAAgC;AAAA,EACrC,aAAa,OACX,MACA,OACA,SACA,WAC4B;AAC5B,UAAM,WAAW,IAAI,kBAAkB,MAAM,OAAO,SAAS,SAAS;AACtE,aAAS,cAAc,QAAQ,QAAQ;AAAA,MACrC,SAAS,cAAc,MAAM,mBAAmB,MAAM,aAAa,kBAAkB,SAAS,CAAC;AAAA,MAC/F;AAAA,IACF;AACA,aAAS,cAAc,QAAQ,MAAM;AAAA,MACnC,SAAS,cAAc,MAAM,qBAAqB,mBAAmB;AAAA,MACrE;AAAA,IACF;AACA,WAAO;AAAA,EACT;AAAA,EAES,oBAAoB,IAAI,YAAY,EAAE,WAAW,KAAK,CAAC;AAAA,EACvD,gBAAgB,IAAI,kBAAkB,IAAI,YAAY,EAAE,WAAW,MAAM,CAAC,CAAC;AAAA,EAC3E;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EAED,YACN,MACA,OACA,SACA,WACA;AACA,SAAK,QAAQ;AACb,SAAK,SAAS;AACd,SAAK,WAAW;AAChB,SAAK,aAAa;AAAA,EACpB;AAAA,EAEA,MAAM,UAA+B;AACnC,SAAK,OAAO,OAAO,MAAM,wBAAwB,KAAK,KAAK,EAAE;AAE7D,UAAM,cACJ,MAAM,QAAQ,IAAI,MAAM,KAAK,KAAK,UAAU,OAAO,CAAC,QAAQ,QAAQ,MAAM,KAAK,eAAe,QAAQ,QAAQ,CAAC,CAAC,GAChH,QAAQ,CAAC,SAAS,IAAI;AAExB,UAAM,EAAE,SAAS,QAAQ,IAAI,KAAK;AAElC,WAAO;AAAA,MACL,CAAC,GAAG,QAAQ,OAAO,GAAG,GAAG,YAAY,GAAG,QAAQ,OAAO,CAAC;AAAA,MACxD,KAAK,kBAAkB,mBAAmB,KAAK,KAAK;AAAA,IACtD;AAAA,EACF;AAAA,EAEA,MAAM,eACJ,QACA,UAC+B;AAC/B,SAAK,OAAO,OAAO,MAAM,+BAA+B,KAAK,KAAK,IAAI,MAAM,EAAE;AAE9E,YACE,MAAM,QAAQ;AAAA,MACZ,OAAO,OAAO,UAAU,WAAW,EAChC,OAAO,CAAC,eAAe,SAAS,UAAU,CAAC,EAC3C;AAAA,QACC,OAAO,eACL,iCAAiC;AAAA,UAC/B;AAAA,UACA,KAAK;AAAA,UACL;AAAA,UACA,SAAS,UAAU;AAAA,UACnB,KAAK;AAAA,UACL,KAAK;AAAA,QACP,GAAG,QAAQ,KAAK,UAAU;AAAA,MAC9B;AAAA,IACJ,GACA,OAAO,OAAO;AAAA,EAClB;AACF;",
  "names": []
}
