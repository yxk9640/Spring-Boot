import Plugin from "@hilla/generator-typescript-core/Plugin.js";
import BackbonePlugin, { BackbonePluginSourceType } from "@hilla/generator-typescript-plugin-backbone";
import PluginError from "@hilla/generator-typescript-utils/PluginError.js";
import BarrelProcessor from "./BarrelProcessor.js";
class BarrelPlugin extends Plugin {
  get path() {
    return import.meta.url;
  }
  // eslint-disable-next-line @typescript-eslint/require-await
  async execute({ pluginStorage, sources }) {
    const tags = pluginStorage.get(BackbonePlugin.BACKBONE_PLUGIN_FILE_TAGS);
    if (!tags) {
      throw new PluginError(`${BackbonePlugin.name} should be run first.`, this.constructor.name);
    }
    const endpoints = sources.filter((file) => tags.get(file) === BackbonePluginSourceType.Endpoint);
    const barrelFile = new BarrelProcessor(endpoints, this).process();
    sources.push(barrelFile);
  }
}
export {
  BarrelPlugin as default
};
//# sourceMappingURL=index.js.map
